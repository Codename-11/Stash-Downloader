name: Stash Downloader
description: Download images and videos from URLs with automatic metadata extraction and organization
version: 0.1.0
url: https://github.com/Codename-11/Stash-Downloader
settings:
  serverDownloadPath:
    displayName: Download Path
    description: "Absolute path for downloaded files (relative to Stash server/container). Overrides Stash library if set. Examples: /data/downloads, /mnt/media/videos. Default: /data/StashDownloader. Leave empty to use your Stash video library."
    type: STRING
  httpProxy:
    displayName: HTTP Proxy
    description: HTTP/HTTPS proxy for server-side downloads (e.g., http://proxy.example.com:8080 or socks5://proxy.example.com:1080)
    type: STRING
  concurrentDownloads:
    displayName: Concurrent Downloads
    description: Maximum number of simultaneous downloads
    type: NUMBER
  autoCreatePerformers:
    displayName: Auto-Create Performers
    description: Automatically create new performers if they don't exist in Stash
    type: BOOLEAN
  autoCreateTags:
    displayName: Auto-Create Tags
    description: Automatically create new tags if they don't exist in Stash
    type: BOOLEAN
  autoCreateStudios:
    displayName: Auto-Create Studios
    description: Automatically create new studios if they don't exist in Stash
    type: BOOLEAN
  downloadQuality:
    displayName: Download Quality
    description: "Preferred quality for video downloads (best, 1080p, 720p, 480p)"
    type: STRING
  filenameTemplate:
    displayName: Filename Template
    description: "Template for downloaded filenames. Variables: {title}, {date}, {performers}, {studio}"
    type: STRING
  enableNotifications:
    displayName: Enable Notifications
    description: Show browser notifications for download completion
    type: BOOLEAN
  redditClientId:
    displayName: Reddit Client ID
    description: "Reddit API client ID (get from https://www.reddit.com/prefs/apps). Required for importing saved/upvoted posts."
    type: STRING
  redditClientSecret:
    displayName: Reddit Client Secret
    description: "Reddit API client secret (get from https://www.reddit.com/prefs/apps). Required for importing saved/upvoted posts."
    type: STRING
  redditUsername:
    displayName: Reddit Username
    description: "Your Reddit username. Required for importing saved/upvoted posts."
    type: STRING
  redditPassword:
    displayName: Reddit Password
    description: "Your Reddit password. Required for importing saved/upvoted posts."
    type: STRING
  embedRedditMetadata:
    displayName: Embed Reddit Metadata
    description: "Embed Reddit post metadata into downloaded files (EXIF for images, FFmpeg for videos). Requires piexif and ffmpeg."
    type: BOOLEAN

# Python backend for server-side downloads (bypasses CORS)
# Same pattern as PythonDepManager (interface: raw + {pluginDir})
exec:
  - python
  - "{pluginDir}/scripts/download.py"

tasks:
  - name: Download Video
    description: Download a video from URL using yt-dlp (server-side)
    defaultArgs:
      mode: download
  - name: Extract Metadata
    description: Extract video metadata without downloading
    defaultArgs:
      mode: extract_metadata
  - name: Read Result
    description: Read a saved task result from temp file
    defaultArgs:
      mode: read_result
  - name: Cleanup Result
    description: Delete a saved task result file
    defaultArgs:
      mode: cleanup_result
  - name: Check yt-dlp
    description: Check if yt-dlp is installed and available
    defaultArgs:
      mode: check_ytdlp
  - name: Test Proxy
    description: Test proxy connectivity by fetching a URL
    defaultArgs:
      mode: test_proxy
  - name: Scrape Reddit
    description: Scrape Reddit post metadata (server-side, bypasses CSP)
    defaultArgs:
      mode: scrape_reddit
  - name: Check PRAW
    description: Check if PRAW (Python Reddit API Wrapper) is installed
    defaultArgs:
      mode: check_praw
  - name: Fetch Reddit Posts
    description: Fetch saved or upvoted posts from Reddit using PRAW
    defaultArgs:
      mode: fetch_posts
  - name: Embed Metadata
    description: Embed Reddit metadata into image/video files (EXIF/FFmpeg)
    defaultArgs:
      mode: embed_metadata
  - name: Check Metadata Dependencies
    description: Check if piexif and ffmpeg are available for metadata embedding
    defaultArgs:
      mode: check_metadata_deps

ui:
  javascript:
    - dist/stash-downloader.js
# interface: raw allows Python exec to work as subprocess
# interface: js is for UI plugins but may break Python exec
interface: raw
